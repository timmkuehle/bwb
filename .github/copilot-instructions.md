# Copilot Instructions for MNMLST Child Theme

## Project Overview

This is a WordPress child theme that extends the [MNMLST parent theme](https://github.com/timmkuehle/mnmlst). The parent theme provides a complete build system, asset management, and automatic registration/enqueuing of child theme assets.

**Key principle:** Child theme assets are automatically handled by the parent theme. Never manually enqueue scripts or styles in `functions.php` unless there's a specific reason to override the automatic behavior.

## Development Preferences

### Language and File Type Preferences

- **Always prefer TypeScript (`.ts`/`.tsx`)** over vanilla JavaScript for source files, unless the user explicitly requests JavaScript
- **Always prefer SCSS (`.scss`)** over CSS or Sass for stylesheets, unless the user explicitly requests otherwise

### Code Organization

**File Separation:**

- Use file separation to a reasonable degree for better organization and maintainability
- Import separated files into main entry points

**TypeScript/JavaScript:**

- When separating TypeScript source files, create a `components/` subdirectory for component files
- Example structure:
  ```
  assets/src/scripts/public/
  ├── index.ts              # Main entry point
  └── components/           # Separated components
      ├── MyComponent.ts
      └── AnotherComponent.ts
  ```

**SCSS:**

- Name SCSS sub-files after their usage (e.g., `_header.scss`, `_buttons.scss`, `_navigation.scss`)
- Import these files into the main entry point (e.g., `public.scss` or `admin.scss`)
- **Important:** Never apply this separation logic to files that are enqueued by their filename (e.g., `public.scss`, `admin.scss`, `style.scss`, `editorStyle.scss`)
- Example structure:
  ```
  assets/src/styles/
  ├── public.scss           # Main entry point (enqueued by filename)
  ├── _variables.scss       # Variables and configuration
  ├── _typography.scss      # Typography styles
  └── _buttons.scss         # Button styles
  ```

### CSS Class Naming

- Keep CSS class names **short and precise**
- Always keep them **human-readable and graspable**
- Avoid overly aggressive shortening that sacrifices clarity
- Good: `.nav-menu`, `.post-thumbnail`, `.btn-primary`
- Avoid: `.nm`, `.pt`, `.bp`

### Internationalization (i18n)

- **Always use WordPress's i18n functions** for all user-facing strings
- In TypeScript/JavaScript files:

  ```typescript
  import { __ } from "@wordpress/i18n";

  __("Translatable string", "mnmlst");
  _x("Context-specific string", "context", "mnmlst");
  ```

- In PHP files:
  ```php
  __('Translatable string', 'mnmlst');
  _x('Context-specific string', 'context', 'mnmlst');
  esc_html__('Escaped HTML string', 'mnmlst');
  esc_attr__('Escaped attribute string', 'mnmlst');
  ```
- Never hardcode user-facing strings without wrapping them in i18n functions

## Project Structure

```
mnmlst-child/
├── assets/
│   ├── src/
│   │   ├── scripts/
│   │   │   ├── public/index.{js,jsx,ts,tsx}  → compiles to assets/dist/public.js
│   │   │   └── admin/index.{js,jsx,ts,tsx}   → compiles to assets/dist/admin.js
│   │   └── styles/
│   │       ├── public.{scss,sass,css}         → compiles to assets/dist/public.css
│   │       └── admin.{scss,sass,css}          → compiles to assets/dist/admin.css
│   └── dist/                                  # Compiled assets (auto-generated by webpack)
├── blocks/                                    # Custom Gutenberg blocks
│   └── {block-name}/
│       ├── block.json                         # Block metadata (REQUIRED)
│       ├── index.{js,jsx,ts,tsx}              → editor script
│       ├── script.{js,jsx,ts,tsx}             → front-end and editor script
│       ├── viewScript.{js,jsx,ts,tsx}         → front-end only script
│       ├── style.{scss,sass,css}              → front-end and editor styles
│       └── editorStyle.{scss,sass,css}        → editor only styles
├── plugins/                                   # Custom Gutenberg plugins (editor extensions)
│   └── {plugin-name}/
│       ├── index.{js,jsx,ts,tsx}              → plugin script (contains registerPlugin)
│       └── style.{scss,sass,css}              → plugin styles
├── template-parts/                            # Override parent theme template parts
├── languages/                                 # Translation files (.po, .mo, .json)
├── functions.php                              # Theme functions (PHP extensions)
└── style.css                                  # Theme header (required by WordPress)
```

## Asset Management

### Automatic Enqueuing

**CRITICAL:** The parent theme automatically enqueues:

- `assets/dist/public.js` and `assets/dist/public.css` on the front-end
- `assets/dist/admin.js` and `assets/dist/admin.css` in the admin area
- All Gutenberg blocks in `blocks/*/` directories
- All Gutenberg plugins in `plugins/*/` directories

**DO NOT** manually enqueue these assets in `functions.php` unless specifically overriding default behavior.

### Entry Points

When creating scripts or styles, use these specific entry points:

**Front-end script:**

- Create/modify: `assets/src/scripts/public/index.{js,jsx,ts,tsx}`
- Compiled to: `assets/dist/public.js`

**Admin script:**

- Create/modify: `assets/src/scripts/admin/index.{js,jsx,ts,tsx}`
- Compiled to: `assets/dist/admin.js`

**Front-end stylesheet:**

- Create/modify: `assets/src/styles/public.{scss,sass,css}`
- Compiled to: `assets/dist/public.css`

**Admin stylesheet:**

- Create/modify: `assets/src/styles/admin.{scss,sass,css}`
- Compiled to: `assets/dist/admin.css`

## WordPress & Gutenberg Development

### WordPress Packages

Use WordPress's npm packages for Gutenberg development:

```javascript
import { registerBlockType } from "@wordpress/blocks";
import { useBlockProps, InspectorControls } from "@wordpress/block-editor";
import { PanelBody, TextControl } from "@wordpress/components";
import { __ } from "@wordpress/i18n";
import { registerPlugin } from "@wordpress/plugins";
```

Available packages (already in dependencies):

- `@wordpress/blocks`
- `@wordpress/block-editor`
- `@wordpress/components`
- `@wordpress/element`
- `@wordpress/i18n`
- `@wordpress/plugins`
- `@wordpress/data`
- `@wordpress/core-data`
- `@wordpress/editor`

### Creating Gutenberg Blocks

1. **Create block directory:** `blocks/{block-name}/`

2. **Create `block.json` (REQUIRED):**

   ```json
   {
     "apiVersion": 2,
     "name": "mnmlst/{block-name}",
     "title": "Block Title",
     "category": "text",
     "icon": "smiley",
     "description": "Block description",
     "supports": {
       "html": false
     },
     "textdomain": "mnmlst",
     "editorScript": "file:./index.js",
     "editorStyle": "file:./editorStyle.css",
     "style": "file:./style.css",
     "viewScript": "file:./viewScript.js"
   }
   ```

3. **Create `index.tsx` or `index.jsx`:**

   ```typescript
   import { registerBlockType } from '@wordpress/blocks';
   import { useBlockProps } from '@wordpress/block-editor';
   import { __ } from '@wordpress/i18n';

   registerBlockType('mnmlst/block-name', {
     edit: () => {
       const blockProps = useBlockProps();
       return <div {...blockProps}>{__('Editor view', 'mnmlst')}</div>;
     },
     save: () => {
       const blockProps = useBlockProps.save();
       return <div {...blockProps}>{__('Front-end view', 'mnmlst')}</div>;
     },
   });
   ```

4. **Optional files:**
   - `style.scss` - Styles for both editor and front-end
   - `editorStyle.scss` - Editor-only styles
   - `viewScript.ts` - Front-end only JavaScript
   - `script.ts` - JavaScript for both editor and front-end

### Creating Gutenberg Plugins

Gutenberg plugins extend the editor (e.g., sidebar panels, toolbar buttons, custom slots).

1. **Create plugin directory:** `plugins/{plugin-name}/`

2. **Create `index.tsx` or `index.jsx`:**

   ```typescript
   import { registerPlugin } from '@wordpress/plugins';
   import { PluginSidebar } from '@wordpress/edit-post';
   import { PanelBody, TextControl } from '@wordpress/components';
   import { __ } from '@wordpress/i18n';

   const MyPlugin = () => (
     <PluginSidebar name="my-plugin" title={__('My Plugin', 'mnmlst')}>
       <PanelBody>
         <TextControl label={__('Setting', 'mnmlst')} />
       </PanelBody>
     </PluginSidebar>
   );

   registerPlugin('mnmlst-my-plugin', {
     render: MyPlugin,
   });
   ```

3. **Optional: Create `style.scss`** for plugin-specific styles

## Text Domain and Internationalization

**Text domain:** `mnmlst` (inherited from parent theme)

### In JavaScript/TypeScript:

```javascript
import { __ } from "@wordpress/i18n";

__("Translatable string", "mnmlst");
_x("Context-specific string", "context", "mnmlst");
```

### In PHP:

```php
__('Translatable string', 'mnmlst');
_x('Context-specific string', 'context', 'mnmlst');
esc_html__('Escaped HTML string', 'mnmlst');
esc_attr__('Escaped attribute string', 'mnmlst');
```

### Translation Workflow:

1. Extract strings: `npm run extract-translations`
2. Edit `.po` file in `languages/` directory
3. Generate JSON for JS: `npm run translate-js`

## TypeScript Usage

This project uses TypeScript. When creating new files:

**Prefer `.tsx` for:**

- Files with JSX/React components
- Gutenberg blocks and plugins

**Prefer `.ts` for:**

- Utility functions
- Classes
- Non-React code

**Type definitions:**

- WordPress types are available via `@types/wordpress__block-editor` and similar packages
- Use proper typing for block attributes, props, and component interfaces

Example:

```typescript
interface BlockAttributes {
  content: string;
  alignment: string;
}

interface EditProps {
  attributes: BlockAttributes;
  setAttributes: (attrs: Partial<BlockAttributes>) => void;
}

const Edit = ({ attributes, setAttributes }: EditProps) => {
  // ...
};
```

## Code Style and Formatting

### Linting and Formatting Tools:

- **ESLint** - JavaScript/TypeScript linting
- **Prettier** - Code formatting
- **PHP-CS-Fixer** - PHP formatting
- **TypeScript** - Type checking

### Commands:

- `npm run lint` - Run TypeScript compiler and ESLint
- `npm run format` - Format all code (PHP and JS/TS)

### Code Style Guidelines:

- Use **2 spaces** for indentation in JS/TS
- Use **tabs** for indentation in PHP (WordPress standard)
- Use **single quotes** in JavaScript, **double quotes** in PHP
- Use **semicolons** in JavaScript/TypeScript
- Follow **WordPress PHP Coding Standards**

## Build System

### Webpack Configuration

The project uses webpack to compile assets. Key features:

- **Babel** for modern JavaScript/JSX transpilation
- **TypeScript** support via babel-loader
- **Sass/SCSS** preprocessing
- **@wordpress/dependency-extraction-webpack-plugin** - Automatically generates `.asset.php` files with WordPress dependencies
- **@automattic/babel-plugin-preserve-i18n** - Preserves i18n function calls

### Build Commands:

- `npm start` - Development build with watch mode (auto-rebuild on file changes)
- `npm run build` - Production build (minified, optimized)

**After creating or modifying assets:** Run `npm start` or `npm run build` to compile them.

## Parent Theme Features

The child theme has access to these MNMLST parent theme features:

### MNMLST Featured Media

- Allows setting videos as featured media (not just images)
- Custom post meta: `_mnmlst_featured_media`
- Use `mnmlst_post_thumbnail()` PHP function to display

### MNMLST Menu Item Icons

- Add custom icons to menu items in the menu editor
- Custom post meta: `_mnmlst_menu_item_icon`

### MNMLST Fullscreen Video Player

- JavaScript class: `FullscreenVideoPlayer`
- Template: `template-parts/features/feature-fullscreen-video-player.php`
- Trigger with class: `.mnmlst_fullscreen-video-player__play-btn`

### MNMLST Dynamic Header

- JavaScript class: `DynamicHeader`
- Adds `.solid` class to header when scrolling
- Use for transparent-to-opaque header transitions

## Template Parts

To override a parent theme template part, create the same file path in the child theme:

```
Parent: wp-content/themes/mnmlst/template-parts/post/post-thumbnail-img.php
Child:  wp-content/themes/mnmlst-child/template-parts/post/post-thumbnail-img.php
```

## PHP Functions

For custom PHP functionality:

1. Add directly to `functions.php`
2. Or create files in an `inc/` directory and include them:
   ```php
   require_once get_stylesheet_directory() . '/inc/custom-functions.php';
   ```

**Important:**

- Use `get_stylesheet_directory()` for child theme paths
- Use `get_template_directory()` for parent theme paths
- Always use WordPress coding standards (tabs, yoda conditions, etc.)

## Common Patterns

### Adding a Custom Gutenberg Block:

1. Create directory: `blocks/my-block/`
2. Add `block.json` with metadata
3. Create `index.tsx` with `registerBlockType`
4. Optionally add `style.scss`
5. Run `npm start` to compile
6. Block is automatically registered by parent theme

### Adding Front-end JavaScript:

1. Edit/create: `assets/src/scripts/public/index.ts`
2. Write your code (use ES6+ features)
3. Run `npm start` to compile
4. Script is automatically enqueued on front-end by parent theme

### Adding Front-end Styles:

1. Edit/create: `assets/src/styles/public.scss`
2. Write Sass/SCSS (or plain CSS)
3. Run `npm start` to compile
4. Stylesheet is automatically enqueued on front-end by parent theme

### Accessing WordPress REST API:

```javascript
import apiFetch from "@wordpress/api-fetch";

apiFetch({ path: "/wp/v2/posts" }).then((posts) => {
  console.log(posts);
});
```

## Important Reminders

1. **Never manually enqueue child theme assets** - the parent theme does this automatically
2. **Always include `block.json`** for Gutenberg blocks
3. **Use text domain `mnmlst`** for all translations
4. **Run build commands** after creating/modifying assets
5. **Use TypeScript** for new JavaScript files
6. **Follow WordPress coding standards** for PHP
7. **Use WordPress packages** for Gutenberg development
8. **Test in both editor and front-end** when creating blocks

## Resources

- [MNMLST Parent Theme](https://github.com/timmkuehle/mnmlst)
- [WordPress Block Editor Handbook](https://developer.wordpress.org/block-editor/)
- [WordPress Theme Development](https://developer.wordpress.org/themes/)
- [@wordpress/scripts Documentation](https://developer.wordpress.org/block-editor/reference-guides/packages/packages-scripts/)
